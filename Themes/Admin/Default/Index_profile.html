<extend name="Public:base"/>

<block name="main">
<style type="text/css">
.tab-content{padding-top: 5px;}
.nav>li>a {padding: 6px 10px;}
</style>
<div id="yzh-content" class="col-xs-12">
  <div class="dataTables_wrapper">
    <ul class="nav nav-pills" role="tablist">
      <li role="presentation" class="active"><a href="#home" role="tab" data-toggle="tab">管理员信息设置</a></li>
      <li role="presentation"><a href="#user" role="tab" data-toggle="tab">修改密码</a></li>
    </ul>
    <!-- Tab panes -->
    <div class="tab-content">
      <div role="tabpanel" class="tab-pane active" id="home">
      <form id="myform1" action="{:U('Index/profile')}" method="post">
        <table class="form-table" width="100%">
          <tr>
            <td  class="password-page" width="220" height="30">{:L('username')}</td>
            <td>{$vo.username}</td>
          </tr>
          <tr>
            <td class="password-page">{:L('email')}</td>
            <td><input type="text" class="input-text"  name="email" value="{$vo.email}" validate="required:true,email:true,remote: '{:U('Login/checkEmail?userid='.$_SESSION['userid'])}' , minlength:1, maxlength:40"><em>(用于找回密码)</em></td>
          </tr>
        </table>
        <div class="btn">
          <input type="hidden" name="id" value="{$vo.id}"/>
          <input type="submit" name="dosubmit"  value="{:L('dosubmit')}" class="btn btn-sm btn-primary" />
          <input type="hidden" name="dosubmit" value="1" />
          <input type="reset" value="{:L('cancel')}" class="btn btn-sm btn-primary"/>
        </div>
      </form>
    </div>

    <div role="tabpanel" class="tab-pane" id="user">
    <form id="myform2" method="post" action="{:U('index/password')}">
      <table class="form-table">
      <tr>
        <td>{:L('oldpassword')}</td>
        <td><input type="password" class="input-text" name="oldpassword" validate=" required:true, minlength:5, maxlength:20"></td>
      </tr>
      <tr>
        <td>{:L('newpassword')}</td>
        <td><input type="password" class="input-text"  name="password" id="password" validate="required:true, minlength:5, maxlength:20"></td>
      </td>
      <tr>
        <td>{:L('repassword')}</td>
        <td><input type="password" class="input-text"  name="repassword" validate=" required:true,equalTo: '#password', minlength:5, maxlength:20"></td>
      </tr>
      <tr>
        <td>{:L('verify')}</td>
        <td><input type="text" class="input-text" size="6" name="verify"> <img SRC="{:U('home/index/verify')}" BORDER="0" ALT="{:L('reverify')}" id="verifyImage" onClick="resetVerifyCode()" style="cursor:pointer" align="absmiddle">
        </td>
      </tr>
      </table>
      <div style="padding:5px;">
        <input type="submit" class="btn btn-sm btn-primary" value="{:L('dosubmit')}"/>
        <input type="reset" class="btn btn-sm btn-primary" value="{:L('cancel')}"/>
      </div>
    </form>
  </div>
</div>


<script type="text/javascript">
$(document).ready(function() {
  $('#myform1').ajaxForm({
    success:  complete,  // post-submit callback
    dataType: 'json'
  });
  $('#myform2').ajaxForm({
    success:  complete,  // post-submit callback
    dataType: 'json'
  });
});

function complete(data){
  if(data.status==1){
    $.scojs_message('修改成功', $.scojs_message.TYPE_OK);
    setTimeout(function(){  
      window.location.href = '{:U("Index/profile")}';
    },1000);
  }else{
    $.scojs_message(data.info, $.scojs_message.TYPE_ERROR);
  }

}
</script>
</block>